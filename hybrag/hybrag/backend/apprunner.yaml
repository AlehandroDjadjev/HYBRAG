version: 1.0
runtime: python3

build:
  commands:
    build:
      - pip install -r requirements.txt

run:
  runtime-version: 3.8.16
  command: sh startup.sh
  network:
    port: 8000
  env:
    - name: DJANGO_SETTINGS_MODULE
      value: server.settings
    - name: SECRET_KEY
      value: dev

    # ---- AWS / SageMaker ----
    - name: AWS_REGION
      value: eu-north-1
    - name: SAGEMAKER_ENDPOINT
      value: siglip2-async-endpoint
    - name: SAGEMAKER_ENDPOINT_NAME
      value: siglip2-async-endpoint
    - name: SAGEMAKER_RUNTIME_REGION
      value: eu-north-1
    - name: SAGEMAKER_ASYNC
      value: "1"
    - name: ASYNC_S3_INPUT_BUCKET
      value: sagemaker-eu-north-1-050608054893
    - name: ASYNC_S3_INPUT_PREFIX
      value: "siglip2-async-inputs/"
    - name: ASYNC_S3_OUTPUT_BUCKET
      value: sagemaker-eu-north-1-050608054893
    - name: ASYNC_S3_OUTPUT_PREFIX
      value: "siglip2-async-outputs/"
    - name: SAGEMAKER_ASYNC_TIMEOUT
      value: "180"

    # ---- Model / device ----
    - name: SIGLIP_MODEL_NAME
      value: google/siglip2-giant-opt-patch16-384
    - name: DEVICE
      value: auto

    # ---- Gunicorn runtime ----
    - name: NUM_WORKERS
      value: "2"
    - name: TIMEOUT
      value: "600"

    # ---- S3 (general app bucket) ----
    - name: S3_BUCKET
      value: sagemaker-eu-north-1-050608054893

    # ---- S3 Vector DB ----
    - name: VECTOR_S3_BUCKET
      value: "google-siglip2-giant-opt-patch16-384-vector-db"
    - name: VECTOR_S3_REGION
      value: "us-east-1"
    - name: VECTOR_S3_INDEX
      value: "images"
    - name: VECTOR_S3_PREFIX
      value: "vectors/"
    - name: VECTOR_S3_CREATE
      value: "0"
    - name: VECTOR_S3_IS_VECTOR_BUCKET
      value: "1"

    # ---- Pinecone ----
    - name: PINECONE_API_KEY
      value: "pcsk_41ubyE_GdMssC1R7owbZvZT3u9bNkhF58kBPSV2sgYp9fBERLC2bEDfY5dCk9dNXE7B5vF"
    - name: PINECONE_HOST
      value: "https://hybrag-xxrndry.svc.aped-4627-b74a.pinecone.io"
    - name: PINECONE_INDEX
      value: "hybrag"
    - name: PINECONE_NAMESPACE
      value: "images"
    - name: PINECONE_CLOUD
      value: "aws"
    - name: PINECONE_REGION
      value: "us-east-1"

    # ---- OpenSearch ----
    # (disabled by default when using S3 Vector DB)
    - name: OS_HOST
      value: ""
    - name: OS_REGION
      value: ""
    - name: OS_USE_IAM
      value: "0"
    - name: OS_USERNAME
      value: ""
    - name: OS_PASSWORD
      value: ""
    - name: OS_INDEX
      value: ""
    - name: OS_EMB_DIM
      value: "1536"
